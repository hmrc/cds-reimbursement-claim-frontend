@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.i18n.Messages
@import play.api.mvc.Request
@import play.twirl.api.Html

@import uk.gov.hmrc.cdsreimbursementclaimfrontend.config.ViewConfig
@import play.twirl.api.HtmlFormat
@import cats.instances.string._
@import cats.syntax.eq._
@import uk.gov.hmrc.cdsreimbursementclaimfrontend.controllers.{routes => controllerRoutes}
@import uk.gov.hmrc.cdsreimbursementclaimfrontend.models.UserType

@this(
    govUkTemplate: views.html.layouts.GovUkTemplate,
    uiHead: uk.gov.hmrc.play.views.html.layouts.HeadWithTrackingConsent,
    uiHeaderNav: uk.gov.hmrc.play.views.html.layouts.HeaderNav,
    uiFooter: uk.gov.hmrc.play.views.html.layouts.Footer,
    uiMainContent: uk.gov.hmrc.play.views.html.layouts.MainContent,
    uiMainContentHeader: uk.gov.hmrc.play.views.html.layouts.MainContentHeader,
    uiFooterLinks: uk.gov.hmrc.play.views.html.layouts.FooterLinks,
    helperReportAProblemLink: uk.gov.hmrc.play.views.html.helpers.ReportAProblemLink,
    userRecruitmentBanner: uk.gov.hmrc.cdsreimbursementclaimfrontend.views.html.components.user_recruitment_banner,
    languageSwitcher: uk.gov.hmrc.cdsreimbursementclaimfrontend.views.html.components.language_switcher
)


@(appConfig: ViewConfig,
  title: String,
  userType: Option[UserType],
  hasErrors: Boolean = false,
  mainClass: Option[String] = None,
  mainDataAttributes: Option[Html] = None,
  bodyClasses: Option[String] = None,
  sidebar: Html = HtmlFormat.empty,
  contentHeader: Option[Html] = None,
  mainContent: Html = HtmlFormat.empty,
  serviceInfoContent: Html = HtmlFormat.empty,
  scriptElem: Option[Html] = None,
  withSignOutLink: Boolean = true,
  withAccount: Boolean)(implicit messages: Messages, request: Request[_])

@head = {
    <script>
      window.getCookie = function (name) {
        var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        if (match) return match[2];
      };
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({
        'userType': "@{userType match {
          case Some(UserType.Individual) => "individual"
          case Some(UserType.Organisation) => "organisation"
          case _ => "anonymous"
        }}"
      })

      window.jsConfig = window.jsConfig || {};
      window.jsConfig.lang = window.getCookie("PLAY_LANG") || "en";
      @if(withSignOutLink || withAccount) {
        window.jsConfig.timeoutEnabled = true;
        window.jsConfig.timeout = @{appConfig.ggTimeoutSeconds};
        window.jsConfig.countdown = @{appConfig.ggCountdownSeconds};
        window.jsConfig.keep_alive_url = "@{appConfig.ggKeepAliveUrl}";
        window.jsConfig.timed_out_url = "@{appConfig.ggTimedOutUrl}";
        window.jsConfig.logout_url = "@{appConfig.ggSignOut}";
      }
    </script>
    @uiHead(
      linkElem = None,
      headScripts = None)

    <meta name="format-detection" content="telephone=no" />
}

@headerNavLinks = {
  @if(withSignOutLink) {
    <li><a href="@{appConfig.signOutUrl}?continue=@{controllerRoutes.StartController.start().url}" id="signOut">@messages("service.signOut")</a></li>
  }
}

@insideHeader = {
    @uiHeaderNav(
      navTitle = Some(messages("service.title")),
      navTitleLink = None,
      showBetaLink = false,
      navLinks = Some(headerNavLinks))
}

@afterHeader = {
  @if(appConfig.userRecruitmentBannerEnabled) {
    @userRecruitmentBanner(appConfig.userRecruitmentUrl)
  }
}

@withCustomJS = {
  @scriptElem
}

@bodyEnd = {
    @uiFooter(
      analyticsToken = None,
      analyticsHost = "",
      ssoUrl = None,
      scriptElem = Some(withCustomJS),
      gaCalls = None)
}

@footerTop = {}
@footerLinks = @{
    uiFooterLinks(accessibilityFooterUrl = Some(controllerRoutes.AccessibilityStatementController.accessibilityStatement().url))
}

@serviceInfo = {
  <div class="service-info">
    @serviceInfoContent
  </div>
}

@mainContentHeader = {
    @contentHeader.fold(Html(""))(header => uiMainContentHeader(contentHeader = header))
    @languageSwitcher(appConfig.enableLanguageSwitching)
}

@getHelpForm = @{helperReportAProblemLink(appConfig.reportAProblemPartialUrl, appConfig.reportAProblemNonJSUrl)}


@serviceNameAndHeading = @{if(title === messages("service.title")) title else title + " - " + messages("service.title")}
@govTitle = @{serviceNameAndHeading + " - GOV.UK"}
@pageTitle = @{if(hasErrors) { messages("generic.errorPrefix") + " " + govTitle } else { govTitle }}

@govUkTemplate(Some(pageTitle), bodyClasses)(head, bodyEnd, insideHeader, afterHeader, footerTop, Some(footerLinks), true){
    @uiMainContent(
    article = mainContent,
    mainClass = mainClass,
    mainDataAttributes = mainDataAttributes,
    mainContentHeader = mainContentHeader,
    serviceInfo = serviceInfo,
    getHelpForm = getHelpForm,
    sidebar = sidebar)
}
